\documentclass[12pt,a4paper]{book}
\usepackage[latin1]{inputenc}    % Ascii-Format dieses Dokuments
\usepackage{longtable}           % lange Tabellen

\begin{document}
\title{EOF\\Eris Onion Forwarding\\
The secure, peer-to-peer, decentralised anonymous chat network}
\date{2009-03-12}
\author{Nico -telmich- Schottelius}

\maketitle
\tableofcontents
\newpage

% -----------------------------------------------------------------------------
\chapter{Introduction}
% -----------------------------------------------------------------------------
\section{Abstract}
EOF is a chat protocol that supports secure chatting.
Secure chatting consists of the following features:
\begin{enumerate}
\item Nobody, but the intended receiver(s) know(s) \emph{that} you wrote a message.
\item Nobody, but the intended receiver(s) can view the \emph{message content}.
\item Nobody, but the intended receiver(s) can \emph{verify} the source of the message being you.
\item Nobody, but the intended receiver(s) know(s) \emph{who} you sent a message to.
\end{enumerate}
We don't think it's possible to hide that you are part of the chat network.
Thus, every participant of an EOF network will constantly send packets
(so called \emph{noise}) with a defined frequency (for instance every 250 ms).
The noise is also used to defend against timing analysis.
In case you are sending out a message, the message packet will be added to the
queue and sent within the next free time slot.

We encrypt and sign every message via public-key cryptography\cite{pgp-1},
so that only the receiver can decrypt, view the message content and verify
the message sender.

The message packets are always sent indirectly via onion routing\cite{onion-1}.
The idea is taken from the Tor project\cite{tor-1}, though EOF uses an enhanced
version: EOF does not know about entry or exit nodes. If you are the intended
receiver you may or may not continue to forward the message, which is defined
by the sender of the message. That said, EOF must use source
routing\cite{source-routing-1}.

EOF knows about two different chat destinations:
\begin{enumerate}
\item Peers
\item Groups of peers
\end{enumerate}
A peer is just another person (direct chat), a group of peers is the EOF
equivalent of the IRC channel\cite{irc-1}. As there is no central server,
groups of peers are managed by each client, and thus the compositions of
group members may be different on different peers.

EOF does not implement nor specify \emph{transport protocols} itself.
The EOF community is urged to implement them in a creative way: Usage
of well-known protocols like TCP\cite{tcp-1}, HTTP\cite{http-1},
SMTP\cite{smtp-1} or even transmission of packets on avian
carriers\cite{avian-1} are encouraged. The tunneling of EOF packets through
those protocols (also know as obfuscation) makes it harder to detect
and block EOF traffic.
% -----------------------------------------------------------------------------
\section{Motivation}
Must have been written somewhere else already
% -----------------------------------------------------------------------------
\section{Copying, authors, ...}
% -----------------------------------------------------------------------------
\section{Further directions}
Analyse security
enhance performance
port to other systems
spread the word
% -----------------------------------------------------------------------------
\section{Conventions}
\$NAME = variable
% -----------------------------------------------------------------------------
\section{Introduction}
missing :-)
and further sections, too. Currently just documenting what is important
for now.
% -----------------------------------------------------------------------------
\chapter{The EOF protocol}
% -----------------------------------------------------------------------------
\section{Version}
This will be version \textbf{1} of the protocol. It is the first definition.
Further changes will be documented in this section.
% -----------------------------------------------------------------------------
\section{Introduction}
Stateless: source routing, usage of acks.
% -----------------------------------------------------------------------------
\section{Onion-Packets}
What's seen from outside
% -----------------------------------------------------------------------------
\section{Packets}
What's seen from inside (after stripping of the onion skin).
% -----------------------------------------------------------------------------
\section{Data types}
% --------------------------------------------------------------------------
---
\subsection{Commands}
Commands are 4 bytes long and consist of a 4-digit decimal number with one ASCII digit per byte.
% -----------------------------------------------------------------------------
\section{Interface description}
General: piped:
Data from the EOF implementation is received on stdin 

The command is always the first part of a message.

THE FOLLOWING DATA IS AN IMPORT FROM BASICS.TEX

EOF-1\\Basic definitions
2007-11-22 v0.2-train
% -----------------------------------------------------------------------------
\subsection{Command fields}
The command field 0 indicates the direction.
\begin{longtable}{|c|c|}
\caption{Command field 0}\\
\hline
\textbf{Value} & \textbf{Description}\\
\hline
1 & Message is coming from EOF implementation\\
\hline
2 & Message is coming from EOF subsystem (internally)\\
\hline
3 & Message is coming from outside (received packet))\\
\hline
\end{longtable}

The command field 1 indicates the EOF subsystem.
\begin{longtable}{|c|c|}
\caption{Command field 1}\\
\hline
\textbf{Value} & \textbf{Description}\\
\hline
0 & \textbf{eofi2tp}: Transport protocols\\
\hline
1 & \textbf{eofi2ui}: User interface\\
\hline
\end{longtable}

The command fields 2 and 3 are defined by the respective subsystem.
% -----------------------------------------------------------------------------
\subsection{Introduction}
This document specifies the basic datatypes and connection
methods used in EOF-1. The aim is to stop repetition of
datatype definition in other documents.

\subsection{Changelog}
% -----------------------------------------------------------------------------
\subsubsection{v0.1 to v0.2}
\begin{itemize}
\item Add versions specification
\end{itemize}
% -----------------------------------------------------------------------------
\subsubsection{v0.1}
\begin{itemize}
\item Initial release
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{Versions}
This section clearifies the use of versions in the programs and protocols.
% -----------------------------------------------------------------------------
\subsubsection{Protocol}
The version of a protocol consists of 
\begin{itemize}
\item \textbf{major} number,
\item \textbf{minor} number and
\item the \textbf{patchlevel}
\end{itemize}
An increment of either number must be reflected with a protocol version change
within the protocol definition.
% -----------------------------------------------------------------------------
\subsection{Major number}
Within one major number the same aim should be followed. For instance
version "`0.x.y"' could target the first release.
% -----------------------------------------------------------------------------
\subsection{Minor number}
Within one minor number the same functionality should be kept.
For instance "`0.1.y"' contains basic functionality, "`0.2.y"' could
contain completely new functionality.
% -----------------------------------------------------------------------------
\subsection{Patchlevel}
The patchlevels are used to correct mistakes, but do not change the API.
% -----------------------------------------------------------------------------
\subsection{Valid from...}
All protocol definitions (includings drafts) that are released after
\textbf{20071122} should follow this version numbering scheme.
% -----------------------------------------------------------------------------
\subsection{Programs}
% -----------------------------------------------------------------------------
\subsection{Connections}
\subsection{Sockets}
Sockets are named Unix sockets.
\subsection{Stdin  and stdout}
To make programming easier, communication between some parts in EOF-1 is realised
using stdin and stdout. 
% -----------------------------------------------------------------------------
\subsection{Environment}
Environment variable are set from the operating system or from the user.
The following environment variables are used with EOF-1:
% -----------------------------------------------------------------------------
\subsection{HOME}
Home directory of the user.
% -----------------------------------------------------------------------------
\subsection{CEOF\_DIR}
Ceof configuration directory.
% -----------------------------------------------------------------------------
\subsection{CEOF\_CLIENT\_SOCKET}
The socket that the clients (GUIs) should use.
Relative to the directory specified by CEOF\_DIR.
% -----------------------------------------------------------------------------
\subsection{Paths}
% -----------------------------------------------------------------------------
\subsection{Ceof configuration directory}
% -----------------------------------------------------------------------------
\subsubsection{Default case}
Normally, \$HOME is set and \$CEOF\_DIR is not set. In that case
the configuration directory defaults to \textit{\$HOME/.ceof}.
% -----------------------------------------------------------------------------
\subsubsection{HOME is unset}
If the environment variable "`\textit{HOME}`" is not set,
the directory named \textit{.ceof} in the current directory will be used.
% -----------------------------------------------------------------------------
\subsubsection{CEOF\_DIR is set}
If the environment variable "`\textit{CEOF\_DIR}`" is set,
its content will be used to refer to the configuration directory.
% -----------------------------------------------------------------------------
\subsection{Ceof client socket}
The client connects to a socket named \textit{clients/socket}, relative
to the configuration directory.
% -----------------------------------------------------------------------------
\subsubsection{CEOF\_CLIENT\_SOCKET is set}
If the environment variable \textit{CEOF\_CLIENT\_SOCKET} is set,
"`\textit{clients/socket}"` should be replaced by its content.
% -----------------------------------------------------------------------------
\subsection{Datatypes and dataspecification}
% -----------------------------------------------------------------------------
\subsection{Basic data types}
% -----------------------------------------------------------------------------
\subsubsection{Binary numbers}
Between some parts of EOF-1, binary numbers (as in \textit{uint32\t})
are exchanged. -- IS THIS TRUE?
% -----------------------------------------------------------------------------
\subsubsection{The zero byte}
The zero byte is a byte with the value 0.
% -----------------------------------------------------------------------------
\subsubsection{Strings in general}
Strings are transmitted without termination (i.e. no new line, no 0 byte).
% -----------------------------------------------------------------------------
\subsubsection{ASCII numbers}
ASCII numbers use the decimal string representation of a number.
% -----------------------------------------------------------------------------
\subsubsection{Variable length strings}
Before variable length strings the length is submitted in a fixed size
datatype.
% -----------------------------------------------------------------------------
\subsubsection{Fixed length strings}
Fixed length strings contain exactly the specified number of bytes:
A 128-byte fixed length string consists of at most 128 bytes of text,
which is then not zero terminated!
If the text it contains is shorter than the specified length,
it must be padded with zero bytes (see above).
% -----------------------------------------------------------------------------
\subsubsection{Padding data}
Should be random data.
% -----------------------------------------------------------------------------
\subsection{EOF simple data types}
The following sections define the datatypes used in EOF related
applications. The recommened name for use in source
code is added in parentheses after the human understandable name.
% -----------------------------------------------------------------------------
\subsubsection{Peer name (peername)}
The peer name is a 128-byte fixed length string. It is only
used internally to give a peer a rememberable name ("`a nick'").
It is never transmitted over the network.
% -----------------------------------------------------------------------------
\subsubsection{Channel name (channel)}
The channel name is a 128-byte fixed length string.
% -----------------------------------------------------------------------------
\subsubsection{Message text (msgtext)}
The message text is a 128-byte fixed length string.
% -----------------------------------------------------------------------------
\subsubsection{Peer fingerprint (pfpr)}
The peer fingerprint is a 40-byte fixed length string.
% -----------------------------------------------------------------------------
\subsection{EOF packet data types}
All packets must be signed by the sender and encrypted for the receiver.
The different datatypes are just concatenated in the order
described.
An EOF packet always contains 512 bytes.
% -----------------------------------------------------------------------------
\subsubsection{Message packet}
\begin{itemize}
\item Command type "`8000"'
\item Channel name
\item Message text
\end{itemize}
% -----------------------------------------------------------------------------
\subsubsection{Retrieve peer address}
\begin{itemize}
\item Command type "`8001"'
\item Peer fingerprint
\item Padding
\end{itemize}
% -----------------------------------------------------------------------------
\subsubsection{Submit peer address}
\begin{itemize}
\item Command type "`8002"'
\item Peer fingerprint
\item Peer address
\item Padding
\end{itemize}
% -----------------------------------------------------------------------------
\subsubsection{Forward packet}
\begin{itemize}
\item Command type "`8003"'
\item Peer fingerprint
\item Peer address
\item Padding
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{EOF network data types}
These datatypes are transmitted over the network and are only
encapsulated by the specific network protocol.
% -----------------------------------------------------------------------------
\subsection{General network packet}
\begin{itemize}
\item Type of packet
\item Next receiver: Peer address
\item Message text
\end{itemize}
% -----------------------------------------------------------------------------

THE DATA BEFORE IS AN IMPORT FROM BASICS.TEX

% -----------------------------------------------------------------------------
\section{Transport protocols ("`eofi2tp"')}
Environment variables: CWD for listener
URLs are used as defined in RFC3986\cite{uri-1}.
Transport protocols use EOF command ID 0.
% -----------------------------------------------------------------------------
\subsection{1000: Send packet}
\begin{longtable}{|c|c|c|c|}
\caption{Command 1000 parameters}\\
\hline
\textbf{Parameter} & \textbf{Type} & \textbf{Description} & \textbf{Example}\\
\hline
Size & ASCII Number + \textbackslash{}n & Size of message, excluding this header & 424242\\
\hline
Message & Binary data & The message & BLOB\\
\hline
Destination & URL without scheme & The \emph{proto:} part is stripped of & 127.0.0.3:42\\
\hline
\end{longtable}
% -----------------------------------------------------------------------------
\subsection{2000: Packet successfully sent}
This code is returned by the transport protocol subsystem to the
EOF implementation on success.
\begin{itemize}
\item Parameter: none
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{2001: Packet not sent}
This code is returned by the transport protocol subsystem to the
EOF implementation on failure.
\begin{itemize}
\item Parameter: none
\end{itemize}
% -----------------------------------------------------------------------------
\section{The user interface (UI)}
Maybe own section.
List and describe commands.
Command = subsection
% -----------------------------------------------------------------------------
\section{Configuration}
cconfig

% -----------------------------------------------------------------------------
\chapter{Implementation}
Sample implementation for POSIX.

% -----------------------------------------------------------------------------
\chapter{Transport protocols}
% -----------------------------------------------------------------------------
\section{Introduction}
Only lower-case allowed (to prevent problems with broken filesystems).
% -----------------------------------------------------------------------------
\section{Examples}
This sections shows some theoretic (theoretic because nobody implemented
them yet) transport protocols.
% -----------------------------------------------------------------------------
\subsection{tcp}
% -----------------------------------------------------------------------------
\subsection{tcps}
% -----------------------------------------------------------------------------
\subsection{udp}
% -----------------------------------------------------------------------------
\subsection{http}
% -----------------------------------------------------------------------------
\subsection{https}
% -----------------------------------------------------------------------------
\subsection{smtp}
connect to smtp server
% -----------------------------------------------------------------------------
\subsection{smtps}
% -----------------------------------------------------------------------------
\subsection{mediawiki}
url, user, password
% -----------------------------------------------------------------------------
\subsection{smb}
write on windows shares
% -----------------------------------------------------------------------------
\subsection{email}
Write an email to some address. Needs smtp-server set in configuration.
% -----------------------------------------------------------------------------
\subsection{dns}
Use dns traffic to transport EOF protocols.

% -----------------------------------------------------------------------------
\section{Embedding into EOF}
This section explains how to integrate a transport protocol into EOF.
% -----------------------------------------------------------------------------
\subsection{Adding a transport protocol}
If you want to add the transport protocol \emph{tptest}:
\begin{itemize}
\item Create the directories
\begin{itemize}
\item \textbf{\$HOME/.ceof/transport-protocols/available/\emph{tptest}}.
\end{itemize}
\item Create (link or copy) the executables to the filenames \textbf{listen}
and \textbf{send}.
\end{itemize}
The EOF implementation will register the transport protocol automatically
at the next start. You may register only the \textbf{listen} or
\textbf{send} part of a protocol.
% -----------------------------------------------------------------------------
\subsection{Using a transport protocol}
So far the EOF implementation knows about the implementation, and may also
already use it for \emph{sending} packets. But there is no listener configured
yet.
To enable a listener for the protocol \emph{tptest} at the URL
\emph{tptest:somewhere@protocol-specific}
\begin{itemize}
\item create a directory below
\begin{itemize}
\item \textbf{\$HOME/.ceof/transport-protocols/enabled/}
\end{itemize}
\item with a name of your choice (f.i. \emph{tptest-somwhere} or \emph{http-80}).
\item Then add the URL to the file named $<\textbf{url}>$.
\item If the transport protocol needs or allows additional configuration files,
you need to create them in that directory.
\end{itemize}
The EOF implementation will parse the URL and check whether a supporting
listener application is available.

Will do chdir() to the directory! tp can open config files in current dir.
what about url?
   url = argv1?

same for listen and send?
   listenurl, sendurl, config in curdir
Yes!

The maximum length of the URL is defined in ceofhack.h (EOF\_L\_ADDRESS).
If it is longer, it will be truncated after \textbf{EOF\_L\_ADDRESS} bytes.

IMPORTANT!
% -----------------------------------------------------------------------------

\section{Implementations}
The following sections cover existent protocol implementations.
The name of the section is the name of the registered implementation.
Every section must at least contain:
\begin{itemize}
\item Author contact information
\item URL of website
\item EOF-Version that introduces support for the protocol
\end{itemize}

If there are multiple implementations available, create two subsections
covering both implementations.
% -----------------------------------------------------------------------------
\chapter{gui2ceof import}

Version: 2007-11-16 v0.3-bed / telmich

% -----------------------------------------------------------------------------
\section{Introduction}
This document specifies the commands send from GUI to and from
ceof\footnote{the central EOF-1 application} to the GUIs.
% -----------------------------------------------------------------------------
\subsection{Changelog}
% -----------------------------------------------------------------------------
\subsubsection{draft-1 to v0.2-bed}
\begin{itemize}
\item Many cleanups
\item Changed socket location
\item Clearified what todo without \textit{CEOF\_DIR} and \textit{HOME} set
\item Added exit command.
\item Changed number of bytes for marktschreier from 512 Bytes to 128 Bytes
\item Changed number of bytes for channel name  from 512 Bytes to 128 Bytes
\item Added ranges (001-00x)
\end{itemize}
% -----------------------------------------------------------------------------
\subsubsection{v0.2-bed to v0.3-bed}
\begin{itemize}
\item Add fingerprint to \textbf{0021}
\item Add command \textbf{0023}: Retrieve peer fingerprint
\item Link to the basic documentation
\end{itemize}
% -----------------------------------------------------------------------------
\section{Connection}
Use the ceof client socket, as specified in the basic documentation.
% -----------------------------------------------------------------------------
\section{Commands}
All commands are send as 4-Byte ASCII digits (for instance "`0012"').
All answers and all numbers are ASCII-numbers. We
\textbf{never} transmit binary numbers.
\textbf{Client commands} always begin with \textbf{0} ("`0042"' for instance),
\textbf{answers} or \textbf{notifications} from
\textbf{ceof} begin with \textbf{1} ("`1023"' for instance).
After each command follows individual data. The second byte indicates the type of message:
\begin{itemize}
\item \textbf{00}: client meta command (something that does not affect the user)
\begin{itemize}
\item \textbf{000}: (De-)Initialisation
\item \textbf{001}: Marktschreier related
\item \textbf{002}: Peer related
\item \textbf{003}: Channel related
\end{itemize}
\item \textbf{01}: messages
\item \textbf{11}: sucess answers from ceof
\item \textbf{12}: error answers from ceof
\item \textbf{13}: messages / notifications initiated by ceof
\end{itemize}

% -----------------------------------------------------------------------------
\subsection{0000: Register client}
After the "`0000"' the client directly appends two ASCII digits containing the
version of the client to ceof protocol it speaks. This specification uses version
"`04"'.
Answers from ceof:
\begin{itemize}
\item \textbf{1100}: success, you are connected
\item \textbf{1200}: version not supported
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{0001: Deregister client}
This client derigesters from ceof. Ceof will keep on running, even if this
was the last client.
Answers from ceof:
\begin{itemize}
\item \textbf{1101}: sucess, you are disconnected
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{0009: Request for exit}
Tells ceof to exit and to notify all guis to exit.
It will not reply anything to you, but issue an exit notify to all clients,
including the requesting one.
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{0010: List connected markschreiers}
Answers from ceof:
\begin{itemize}
\item \textbf{1102}: list follows
\begin{itemize}
\item four ASCII-digits containing number of peers ("`num\_peer"')
\item after that follow \textit{num\_peer} peer ids:
\begin{itemize}
\item 128 Byte containing the peer name (if shorter it is padded with 0-bytes), 0 terminated
\item 40 Byte containing the fingerprint of the
key\footnote{See RFC 2440, 11.2. Key IDs and Fingerprints}
\end{itemize}
\end{itemize}
\end{itemize}
% -----------------------------------------------------------------------------
% ok
% -----------------------------------------------------------------------------
\subsection{0011: Connect to markschreier}
After the "`0011"' follow 128 Bytes describing how to connect
to the marktschreier ("`tcp://62.65.138.66:42'" for instance).
If the URI is shorter than 128 bytes, the remain should be filled with 0 bytes
(also known as \verb='\0'=).

Answers from ceof:
\begin{itemize}
\item \textbf{1103}: success
\item \textbf{1210}: protocol (like "`tcp://"') not supported
\item \textbf{1211}: connection could not be established
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{0020: Retrieve list of known peers}
Answers from ceof:
\begin{itemize}
\item \textbf{1120}: list follows
\begin{itemize}
\item four ASCII-digits containing number of peers ("`num\_peer"')
\item after that follow \textit{num\_peer} peer ids:
\begin{itemize}
\item 128 Byte containing the peer name (if shorter it is padded with 0-bytes), 0 terminated
\item 40 Byte containing the fingerprint of the
key\footnote{See RFC 2440, 11.2. Key IDs and Fingerprints}
\end{itemize}
\end{itemize}
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{0021: Add peer}
Aftere the "`0021"' follow

\begin{itemize}
\item 128 bytes for the name of the peer
\item 128 bytes describing how to connect to the peer.
\item 40 bytes  containing the pgp-fingerprint of the key
\end{itemize}
Answers from ceof:
\begin{itemize}
\item \textbf{1121}: success, registered peer
\item \textbf{1220}: unknown peer
\item \textbf{1222}: peer name already used
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{0022: Send message to peer}
Aftere the "`0022"' follow 128 bytes for the peer name
and after that 128 Bytes for the message.
Both 0-terminated, 0 padded.
Answers from ceof:
\begin{itemize}
\item \textbf{1122}: success
\item \textbf{1221}: unknown peer
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{0023: Retrieve peer fingerprint}
Aftere the "`0023"' follows a 128 bytes fixed length string for the peer name.
Answers from ceof:
\begin{itemize}
\item \textbf{1123}: success
\begin{itemize}
\item follows 40 bytes fixed length string containing the fingerprint
\end{itemize}
\item \textbf{1221}: unknown peer
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{0030: Get list of channels}
After the "`0030"' follow 128 Bytes containing the 
name of the peer.

Answers from ceof:

\begin{itemize}
\item \textbf{1130}: got list; following four ASCII-digits containing
number of channels ("`num\_chan"'); after that  num\_chan 128 Bytes packets
follow containing the channel name, padded with 0-bytes
\item \textbf{1230}: connection could not be established
\end{itemize}
% OK
% -----------------------------------------------------------------------------
\subsection{0031: Ask to join a channel via marktschreier}
After the "0031" follow

\begin{enumerate}
\item 128 Bytes containing the peer name
\item 128 Bytes describing the channel name.
\end{enumerate}

Answers from ceof:
\begin{itemize}
\item \textbf{1131}: success (means: markschreier asked known peers to
connect to us)
\item \textbf{1231}: connection could not be established
\item \textbf{1232}: access denied by markschreier: you are not allowed to join
\end{itemize}
% Ok
% -----------------------------------------------------------------------------
\subsection{0032: Send message to channel}
Aftere the "0032" follow 128 bytes for the channel name and after
that 128 Bytes for the message.
Answers from ceof:
\begin{itemize}
\item \textbf{1132}: success
\item \textbf{1233}: unknown channel
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{0033: Create channel}
Aftere the "`0033"' follow 128 bytes containing the name of the channel.
\begin{itemize}
\item \textbf{1133}: success
\item \textbf{1234}: Channel already exists
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{0034: Submit channel to marktschreier}
Aftere the "`0034"' follow 128 bytes containing the channel channel.
\begin{itemize}
\item \textbf{1134}: success
\item \textbf{1235}: Channel already exists
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{1300: Recieved message}
After the "1300" follows:
\begin{itemize}
\item "`C"' for recieved in channel or "`P"' for recieved by a peer
\item 128 byte containing either the channel or the peer name
\item 128 byte containing either the channelname, if the first byte was a "`C"'
\item 128 Byte message
\end{itemize}
% -----------------------------------------------------------------------------
\subsection{1399: Exit notify}
ceof is being shutdown.
Shutdown yourself, too.
After that message ceof will exit and you should do the same.
No answer possible, ceof already decided to vanish.
% -----------------------------------------------------------------------------
\section{The way it works}
This section explains how the commands relate together and which commands to use
in which order.

% -----------------------------------------------------------------------------
\subsection{GUI initiated commands}
This section and all subsections are not yet finished. They
are in this draft to show the interested reader a preview of the
content of the next draft.
% -----------------------------------------------------------------------------
\subsubsection{GUI startup}
What todo, when the GUI starts.
Connect to ceof. Find out about
\begin{itemize}
\item joined channels,
\item connected marktscheier
\item and open queries.
\end{itemize}
It thus issues the following commands:
register, list joined channels, list open queries, list marktschreier.
% -----------------------------------------------------------------------------
\subsubsection{Creating a channel}
When you want to create a channel, you simply have to give it a name.
Ceof will use that name and sign it with your pgp key. The result is the
global unique channel identifier. For testing, you can build your channels
easily on the commandline:
\begin{verbatim}
% echo -n '!eof' > CHANNELNAME
% cat CHANNELNAME 124byteszero > CHANNELNAME.padded
% gpg -s CHANNELNAME 

You need a passphrase to unlock the secret key for
user: "Nico Schottelius (telmich) <nico-public@schottelius.org>"
1024-bit DSA key, ID 9885188C, created 2006-09-27

% ls -l CHANNELNAME*
-rw------- 1 nico nico   4 2007-09-17 21:32 CHANNELNAME
-rw------- 1 nico nico 128 2007-09-17 21:32 CHANNELNAME.padded
-rw------- 1 nico nico 113 2007-09-17 21:32 CHANNELNAME.padded.gpg

% gpg -d CHANNELNAME.padded.gpg 2>/dev/null
!eof
\end{verbatim}
% -----------------------------------------------------------------------------
\subsubsection{Finding a channel}
UNFINISHED
replace internal id with signature!

The GUI asks ceof, which channels are known. After that the GUI
can use the internal ID (which is "`unique"', as in: it is a 32 bit integer
that is increased as long as ceof is running) to join it.
% -----------------------------------------------------------------------------
\subsubsection{Joining a channel}
UNFINISHED
The channel must be known through 
% -----------------------------------------------------------------------------
\subsubsection{Leaving a channel}
UNFINISHED
Sends a message to all known participants that we leave the channel now.
% -----------------------------------------------------------------------------
\subsubsection{Invite to channel}
UNFINISHED
If you create a new channel, you may want to invite people to it.
% -----------------------------------------------------------------------------
\subsubsection{Listing friends}
% -----------------------------------------------------------------------------
\subsection{ceof initiated commands / messages}
UNFINISHED
% -----------------------------------------------------------------------------
\subsubsection{Recieved a join request}
UNFINISHED
Somebody wants to join in a channel, in which you are a member.
% -----------------------------------------------------------------------------
\subsubsection{Recieved a join notification request}
UNFINISHED
Somebody wants us to tell all members of the channel that she wants to join us.
% -----------------------------------------------------------------------------
\subsubsection{Recieved a channel message}
UNFINISHED
Must contain which channel, who send it and what is in the message.
% -----------------------------------------------------------------------------
\subsubsection{Recieved a private message}
UNFINISHED
This messages was send only to us, not to a channel.
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\chapter{gui2user import}

2008-08-17 v0.3-triemli / apic, ilo, telmich

\section{Introduction}
This specification lists Commands to be supported by all GUIs. It
specifies, how the GUI presents itself to the user (gui2user).

\subsection{Writing convention}
Parameters enclosed in $<$ and $>$ must be specified to the command.
Parameters enclosed in $[$ and $]$ can be specified optionally .

\subsection{Minimal philosophy}
This specifications describes all the commands that \textbf{must} be
supported by every client. This means clients may have additional possibilities
to send commands via different methdos (like clicking on a button or via
voice input), but they must support all of the commands listed, because this
way the user always has the familar commands available.

\subsection{Changelog}
\subsubsection{v0.1-mrmcd110b to v0.2-train}
   \begin{itemize}
      \item Renamed \textbf{mslist} to \textbf{mlist}, so it is consequently the prefix
      "`m"' for marktschreier.
      \item Some minor language cleanup 
      \item Added "`minimal philosophy"'
      \item Added minimal writing convention
      \item Added /peer commands
      \item Gave the document some structure
      \item \textbf{Change by}: telmich
   \end{itemize}

\section{Commands}
All commands begin with a "`/"' as first character.

%---------------------------------------------------------------------
\subsection{Command length}
The shall only accept commands up to a langth of 256 Byte.
If the user inputs longer commands, they must be truncated
to 256 Bytes.
%---------------------------------------------------------------------
\subsection{Version 0.1 commands}
Those commands may need to be reworked.
%---------------------------------------------------------------------
\subsubsection{Send text}
If there is no /, it should be assumed that it is a message.
The text will be send to the currently seleceted channel or nick.

%---------------------------------------------------------------------
\subsubsection{/join $<marktschreier>$ $<channel>$}
Join the specific channel on the specified marktschreier.

%---------------------------------------------------------------------
\subsubsection{/list $<markschreier>$}
List available channels on specified marktschreier.

%---------------------------------------------------------------------
\subsection{/mlist}
List connected marktschreier.

%---------------------------------------------------------------------
\subsection{/mconnect $<marktschreier>$}
Connect to marktschreier.

%---------------------------------------------------------------------
\subsection{/whois $<nick>$}
Display detailled information about a nick:
\begin{itemize}
\item PGP fingerprint
\item Full name
\item E-Mail
\end{itemize}

%---------------------------------------------------------------------
\subsubsection{/clist $<channel>$}
Display nicks in the specified channel.

%---------------------------------------------------------------------
\subsubsection{/names}
Display nicks in the currently active channel.

%---------------------------------------------------------------------
\subsubsection{/plist}
List currently known peers.

%---------------------------------------------------------------------
\subsubsection{/leave $<channel>$}
Leave a channel.

%---------------------------------------------------------------------
\subsection{General commands}
\subsubsection{/quit}
Tell ceof to quit, ceof tells all GUIs and subcomponents to quit and quits.

%---------------------------------------------------------------------
\subsection{Peer commands}
Peer related commands.

%---------------------------------------------------------------------
\subsubsection{/peer add $<$name$>$ $<$initial address$>$}
Add the peer as \textit{name} to the list of known peers
and connect to it, to retrieve other addresses.
\begin{itemize}
\item \textit{name} is 128 Bytes, including 0-byte termination.
If the name is shorter it is padded with 0-bytes.
\item \textit{initial address} is 128 Bytes, including 0-byte termination.
If the initial address is shorter it is padded with 0-bytes.
\end{itemize}
%---------------------------------------------------------------------
\subsubsection{/peer rename $<$oldname$>$ $<$newname$>$}
Renames the peer.
%---------------------------------------------------------------------
\subsubsection{/peer list}
List all known peers.
%---------------------------------------------------------------------

\subsection{Alias}
Those commands are provided for easier integration of
new people using EOF.
%---------------------------------------------------------------------
\subsection{/msg $<nick>$ $<message>$}
Is an alias for \textit{/peer send $<$name$>$ $<$message$>$}
%---------------------------------------------------------------------
% -----------------------------------------------------------------------------
\chapter{Unsorted}
\section{Channels}
Exist as long as somebody remembers it
Channel name is signed by creator?
% -----------------------------------------------------------------------------
\appendix
\chapter{Sources}
\begin{thebibliography}{42}
\bibitem{pgp-1} http://en.wikipedia.org/wiki/Public-key\_cryptography
\bibitem{onion-1} http://en.wikipedia.org/wiki/Onion\_routing
\bibitem{tor-1} https://wiki.torproject.org/noreply/TheOnionRouter
\bibitem{irc-1} RFC 1459: http://www.irchelp.org/irchelp/rfc/rfc.html
\bibitem{source-routing-1} http://en.wikipedia.org/wiki/Source\_routing
\bibitem{tcp-1} RFC 793: http://www.faqs.org/rfcs/rfc793.html
\bibitem{http-1} RFC 2616: http://www.faqs.org/rfcs/rfc2616.html
\bibitem{smtp-1} RFC 2821: http://www.faqs.org/rfcs/rfc2821.html
\bibitem{avian-1} RFC 1149: http://www.faqs.org/rfcs/rfc1149.html
\bibitem{uri-1} RFC 3986: http://www.faqs.org/rfcs/rfc3986.html
\end{thebibliography}
\end{document}
